# zle && zle reset-prompt
# note: touch ~/.hushlogin to remove login message

export PATH=$PATH:$HOME/.bin:$HOME/.local/share/nvim/mason/bin/:$HOME/.cargo/bin/:$HOME/go/bin:$HOME/workspaces/python-projects.workspace

# deno
export PATH="/Users/nom/.deno/bin:$PATH"

# hello

setopt autocd # cd without typing cd
autoload -Uz add-zsh-hook

export HISTSIZE=100000 # bigger history
export XDG_CONFIG_HOME=$HOME/.config

# INCLUDES
#
source ~/.zsh/sk.zsh
source ~/.zsh/fzf-marks.zsh
source ~/.zsh/lf.zsh
source ~/.zsh/joshuto.zsh
source ~/.zsh/openai.zsh
source ~/.zsh/fzf-templates.zsh
source ~/.zsh/fzf-custom.zsh
source ~/.zsh/fzf-browser.zsh
source ~/.zsh/prompt-middle.zsh
source ~/.zsh/imagemagick.zsh
source ~/.zsh/exa.zsh
source ~/.env

export FZF_DEFAULT_OPTS="--layout=reverse --inline-info --color=bg+:-1,fg:4,info:15,fg+:5,header:7,hl:5,hl+:5"
export SKIM_DEFAULT_OPTIONS=$FZF_DEFAULT_OPTS
export SKIM_DEFAULT_COMMAND="fd . --max-depth=3"

export HOMEBREW_NO_ENV_HINTS

# block cursor (5=bar)
# echo '\e[1 q'

# COMPLETIONS
#
autoload -Uz compinit; compinit
# 1password
eval "$(op completion zsh)"
compdef _op op
# dotter
# eval "$(dotter gen-completions --shell zsh)"
# compdef _dotter dotter

# ALIASES
#q
alias xdg-open=open
alias o=open
alias ~=grep
alias q=exit
alias lg=lazygit
alias price="price.py"
alias gs="git status"
alias gl="git log"
alias gp="git push"
alias ga="git add . && git commit --amend"
alias gca="ga"
alias push="git push"
alias pull="git pull"
alias b="git branch "$@" --sort=-committerdate --sort=-HEAD --format=$'%(HEAD) %(color:yellow)%(refname:short) %(color:green)(%(committerdate:relative))\t%(color:blue)%(subject)%(color:reset)' --color=always | column -ts$'\t'"
alias branch="b"
alias gb="b"
alias push="git push"
alias pull="git pull"
alias gd="git diff"
alias cb="cargo build"
alias cc="cargo check"
alias cr="cargo run"
alias crr="cargo run --release"
alias ci="cargo install --path ."
alias ct="cargo test"
alias unzip 'atool --extract --explain $1'
alias wiki='cd ~/wiki && e ~/wiki/index.md +"lua GoRoot()"'
alias e='nvim'
# alias e='nvim -c "lua GoRoot()"'
alias edit=nvim
alias e-config="cd ~/config/ && edit ."
alias e-neovim="cd ~/config/neovim/ && edit init.lua"
alias e-joshuto="cd ~/config/joshuto/ && edit joshuto.toml"
alias kitty-joshuto="kitty --override background=#000 --working-directory=$HOME/workspaces --single-instance joshuto"
alias e-zsh="cd ~/config/zsh/ && edit zshrc.conf"
alias e-kitty="cd ~/config/kitty/ && edit kitty.conf"
alias e-snippets="cd ~/config/neovim/snippets/ && edit . +'Telescope find_files'"
alias e-brewfile="edit ~/config/Brewfile"
alias wiki="cd ~/wiki && e index.md"
alias e-wiki=wiki
alias w=wiki
alias e-fzf="fzf_edit"
alias j=joshuto
alias yt="yt-dlp"
alias ytff="yt-dlp --cookies-from-browser=firefox "
alias htop="btm" # I always forget which monitor I have installed
alias bottom="btm"

alias cp-pwd="echo $PWD|pbcopy" # mac only

alias up="cd .."
alias gh="cd ~"
alias gr="cd /"
alias zsh-reload="source ~/.zshrc"

alias loc=tokei

alias p8="ping 8.8.8.8"
alias pg="ping google.com"

alias t="fzf_create_template"
alias new="fzf_create_template"
alias template="fzf_create_template"

alias trash-view="rip --seance"
alias trash-undo="rip --unbury "

alias pandoc-yfm="pandoc "{$1}" -s -f epub -t markdown-markdown_in_html_blocks --extract-media=./ -o book.md --standalone"

alias suckit-sub="suckit -v -j 1 --delay 1 --include-visit '${1}(.*)$' --include-download '${1}(.*)$' ${1}"

alias vim=nvim
alias vi=nvim

alias dd='WD=${PWD} && cd ~/config/ && dotter --cache-directory ~/.config/dotter/cache/ --cache-file ~/.config/dotter/cache.toml deploy --global-config global.toml --local-config local.toml && cd $WD && clear && zsh-reload'
alias dw='cd ~/config/ && dotter --cache-directory ~/.config/dotter/cache/ --cache-file ~/.config/dotter/cache.toml watch --global-config global.toml --local-config local.toml'

alias p="ping cloudflare.com"
alias scrt="secretcli"
alias l="echo && exa --icons --group-directories-first && echo"
alias la="exa --icons --group-directories-first --all"
alias lh="exa --icons --group-directories-first --all"
alias ll="echo && exa --icons --group-directories-first --all --no-time --no-permissions --no-user -l --ignore-glob '.DS_Store' && echo"
alias lll="exa --tree --icons --level 2"

alias lln="exa --icons --all -l --sort=date"
alias vi="nvim"
alias vim="nvim"
alias prev="fzf --layout=reverse --preview 'bat --style=numbers --color=always --line-range :500 {}'"

# todo: convert to fzf
alias doc="cargo doc --open"
alias d-yew="open https://yew.rs/docs/next/"
alias d-rs-yew="open https://docs.rs/yew/latest/yew/"
alias d-rustdoc="open https://doc.rust-lang.org/rustdoc/"
alias d-rustup-cargo="rustup doc --cargo"
alias d-rustup-core="rustup doc --core"
alias d-wasmtime="open https://docs.wasmtime.dev/"
alias d-bevy-cheat="open https://bevy-cheatbook.github.io/"

alias gen-yew-web3="cargo generate --git https://github.com/monomadic/yew-web3-template"

alias ls-colors='for x in {0..8}; do for i in {30..37}; do for a in {40..47}; do echo -ne "\e[$x;$i;$a""m\\\e[$x;$i;$a""m\e[0;37;40m "; done; echo; done; done; echo ""'

alias f-all="fzf-cd"

alias v="viu --height 20"
alias sixel="chafa --clear --format=symbol --center=on --scale=max "
alias sixel-sixel="chafa --clear --format=sixel --center=on --scale=max "
alias sixel-kitty="chafa --clear --format=kitty --center=on --scale=max "
alias img="chafa --format=symbols "

alias workspaces="cd ~/workspaces && l"
alias snippets="cd ~/config/neovim/snippets/ && ll"
alias src="cd ~/src && l"

alias youtube-dl-audio="youtube-dl --extract-audio --audio-format mp3 "

# macos
alias battery='pmset -g batt'

# note: never put nvim in quotes... will print ctrl characters
# export EDITOR=nvim
#export TERM="xterm-256color"
export HOSTNAME=`hostname`

# COMPLETIONS
#
# exec `dotter gen-completions --shell "zsh"`

# PROMPT
# %T time
# if [[ $HOSTNAME = "nom.local" ]]
# 	then
# 		export PROMPT='%F{blue} %~%b%f $ '
# 	else
# 		export PROMPT="%F{green} ${HOSTNAME}  %F{blue} %~%b%f > "
# fi

NC='\033[0m'
BG_PINK='\033[41;37m'
PINK='\033[0;31m'
BLACK='\033[0;30m'
WHITE_HL='\033[47m\033[30m'
export PROMPT="
%F{blue} %~ %F{white}󱞩 %b%f"

# foundry
export PATH="$PATH:/Users/nom/.foundry/bin"

# colors
# export LS_COLORS="$(vivid generate molokai)"

# bun
# export BUN_INSTALL="/Users/nom/.bun"
# export PATH="$BUN_INSTALL/bin:$PATH"
# [ -s "/Users/nom/.bun/_bun" ] && source "/Users/nom/.bun/_bun"

# microcommit
gc () {
	git add . &&
	git commit -a -m "$@" &&
	git pull &&
	git push
}
alias gc-update="gc update:"

quickls () {
	echo
	echo
	ll
	echo
	zle && zle reset-prompt
}; zle -N quickls;

# -s translate input string to output

function clear-reset {
	clear
	hello
	zle && zle reset-prompt
}; zle -N clear-reset;

function cd-up() {
	cd ..
	zle && zle reset-prompt
}; zle -N cd-up;

# KEYBINDINGS
#
bindkey '^ ' lfcd;
# bindkey '^ ' joshuto-wrapper;
bindkey '^f' fzf-cd
bindkey '^k' clear-reset
bindkey '^m' magic-enter
bindkey '^o' fzf-marks
bindkey '^y' fzf-insert
bindkey '^[u' cd-up
# bindkey '^e' fzf_edit
# bindkey '^b' fzm

export WASMTIME_HOME="$HOME/.wasmtime"
export PATH="$WASMTIME_HOME/bin:$PATH"
