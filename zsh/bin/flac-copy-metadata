#!/usr/bin/env zsh

# copyflacmeta: Copy all FLAC metadata (tags + pictures) from one file to another

if [[ $# -ne 2 ]]; then
    print -P "%F{red}Usage:%f $0 source.flac target.flac"
    exit 1
fi

src="$1"
dst="$2"

if [[ ! -f $src ]]; then
    print -P "%F{red}Error:%f source file '$src' not found."
    exit 1
fi

if [[ ! -f $dst ]]; then
    print -P "%F{red}Error:%f target file '$dst' not found."
    exit 1
fi

# Remove all existing metadata blocks in target
metaflac --remove-all "$dst"

# Copy all tags
metaflac --export-tags-to=- "$src" | metaflac --import-tags-from=- "$dst"

# Copy all pictures
metaflac --export-picture-to=- "$src" | metaflac --import-picture-from=- "$dst"

print -P "%F{green}Metadata copied successfully from%f '$src' %F{green}to%f '$dst'."
