#!/usr/bin/env zsh
# fselect-porn â€” search multiple dirs, video extensions, optional NUL output

setopt null_glob

paths=(/Users/nom/Movies/Porn /Volumes/*/Movies/Porn)
exts=('%.mp4' '%.mov' '%.m4v' '%.webm' '%.mkv')

null_term=false
while getopts "0" opt; do
  [[ $opt == 0 ]] && null_term=true
done
shift $((OPTIND - 1))

args=()
for d in "${paths[@]}"; do
  [[ -d $d ]] || continue
  for ext in "${exts[@]}"; do
    args+=("SELECT path FROM \"$d\" WHERE path LIKE '$ext'")
  done
done

(( ${#args[@]} )) || { echo "no matching directories or extensions" >&2; exit 1 }

if $null_term; then
  for query in "${args[@]}"; do
    fselect "$query"
  done | tr '\n' '\0'
else
  for query in "${args[@]}"; do
    fselect "$query"
  done
fi
