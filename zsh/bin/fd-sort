#!/usr/bin/env zsh

# Check if fd is installed
if ! command -v fd &>/dev/null; then
  echo "fd could not be found. Please install fd first."
  exit 1
fi

# Function to search files and sort by creation time (oldest first)
search_and_sort_files() {
  local search_path="$1"

  # Use fd to find all files, then use stat to get creation time
  # Sort the results by creation time (oldest first)
  fd . "$search_path" -t f -0 |
    xargs -0 stat -f '%B %N' |
    sort -n |
    while read -r timestamp filepath; do
      # Convert timestamp to human-readable format
      date -r "$timestamp" '+%Y-%m-%d %H:%M:%S' | tr -d '\n'
      echo ": $filepath"
    done
}

# Check if a path is provided
if [[ $# -eq 0 ]]; then
  echo "Usage: $0 <path>"
  exit 1
fi

# Call the function with the provided path
search_and_sort_files "$1"
